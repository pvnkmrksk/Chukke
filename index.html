<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unique 2x2 Tag Generator</title>
  <!-- Modern Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <!-- Simple Color Picker CSS - no external dependencies -->
  <style>
    :root {
      --primary-color: #4361ee;
      --primary-hover: #3a56d4;
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --text-color: #333;
      --border-color: #e0e0e0;
      --slider-track: #ddd;
      --slider-thumb: #4361ee;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      margin: 0; 
      padding: 0; 
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    
    .container {
      max-width: 1000px;
      margin: 30px auto;
      padding: 0 20px;
    }
    
    @media (max-width: 768px) {
      .container {
        margin: 15px auto;
        padding: 0 15px;
      }
    }
    
    header {
      margin-bottom: 30px;
      text-align: center;
    }
    
    h1 {
      color: var(--text-color);
      margin-top: 0;
      font-weight: 600;
      font-size: 2rem;
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 1.5rem;
      }
    }
    
    .card {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    @media (max-width: 480px) {
      .card {
        padding: 20px 15px;
        border-radius: 8px;
      }
    }
    
    h2 {
      font-size: 1.3rem;
      margin-top: 0;
      margin-bottom: 20px;
      color: var(--text-color);
      font-weight: 600;
    }
    
    p {
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .slider-group {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items: center;
    }
    
    .slider-group input[type="number"] {
      width: 60px;
      text-align: center;
    }
    
    .grid-2col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    
    @media (max-width: 768px) {
      .grid-2col {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }
    
    .grid-4col {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }
    
    @media (max-width: 768px) {
      .grid-4col {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
    }
    
    label {
      margin-bottom: 8px;
      display: block;
      font-weight: 500;
      font-size: 0.95rem;
    }
    
    input[type="number"],
    input[type="text"],
    select {
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 0.95rem;
      width: 100%;
      box-sizing: border-box;
      transition: border-color 0.2s;
      font-family: 'Inter', sans-serif;
    }
    
    /* Styling for range sliders */
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: var(--slider-track);
      outline: none;
      margin: 10px 0;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--slider-thumb);
      cursor: pointer;
      transition: background 0.2s;
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--slider-thumb);
      cursor: pointer;
      transition: background 0.2s;
      border: none;
    }
    
    input[type="range"]::-webkit-slider-thumb:hover {
      background: var(--primary-hover);
    }
    
    input[type="range"]::-moz-range-thumb:hover {
      background: var(--primary-hover);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
    }
    
    .color-picker {
      width: 100%;
      margin-top: 8px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      overflow: hidden;
      height: 40px;
      cursor: pointer;
      position: relative;
    }
    
    .color-picker-input {
      opacity: 0;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .color-display {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-shadow: 0px 0px 2px rgba(0,0,0,0.7);
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .button-group {
      margin-top: 25px;
      display: flex;
      gap: 10px;
    }
    
    @media (max-width: 480px) {
      .button-group {
        flex-direction: column;
      }
    }
    
    button {
      padding: 12px 18px;
      border: none;
      background: var(--primary-color);
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      transition: background 0.2s, transform 0.1s;
      min-height: 48px; /* Better for touch */
    }
    
    button:hover {
      background: var(--primary-hover);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    .button-secondary {
      background: #f0f0f0;
      color: #333;
    }
    
    .button-secondary:hover {
      background: #e4e4e4;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-right: 8px;
    }
    
    .checkbox-group label {
      margin-bottom: 0;
      margin-left: 8px;
      cursor: pointer;
    }
    
    #svgContainer {
      margin-top: 20px;
      padding: 20px;
      background: #fff;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow-x: auto;
    }
    
    /* Hide custom canvas fields by default */
    #customCanvas {
      display: none;
      margin-top: 15px;
    }
    
    .quadrant-settings {
      margin-bottom: 30px;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Unique 2x2 Tag Generator</h1>
      <p>Create unique identification tags with color quadrants for tracking and identification purposes</p>
    </header>
    
    <div class="card">
      <h2>Quadrant Settings</h2>
      <div class="quadrant-settings">
        <div class="grid-4col">
          <div class="form-group">
            <label for="letterTL">Top-Left Letter:</label>
            <input type="text" id="letterTL" value="C" maxlength="1">
            <div class="color-picker" id="pickerTL">
              <input type="color" id="colorTL" value="#00FFFF" class="color-picker-input">
              <div class="color-display" style="background-color: #00FFFF;">C</div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="letterTR">Top-Right Letter:</label>
            <input type="text" id="letterTR" value="M" maxlength="1">
            <div class="color-picker" id="pickerTR">
              <input type="color" id="colorTR" value="#FF00FF" class="color-picker-input">
              <div class="color-display" style="background-color: #FF00FF;">M</div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="letterBL">Bottom-Left Letter:</label>
            <input type="text" id="letterBL" value="Y" maxlength="1">
            <div class="color-picker" id="pickerBL">
              <input type="color" id="colorBL" value="#FFFF00" class="color-picker-input">
              <div class="color-display" style="background-color: #FFFF00;">Y</div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="letterBR">Bottom-Right Letter:</label>
            <input type="text" id="letterBR" value="K" maxlength="1">
            <div class="color-picker" id="pickerBR">
              <input type="color" id="colorBR" value="#000000" class="color-picker-input">
              <div class="color-display" style="background-color: #000000;">K</div>
            </div>
          </div>
        </div>
      </div>
      
      <h2>Canvas Settings</h2>
      <div class="grid-2col">
        <div class="form-group">
          <label for="canvasSize">Canvas Size:</label>
          <select id="canvasSize" onchange="toggleCustomCanvas()">
            <option value="A4">A4 (210×297mm)</option>
            <option value="Letter">Letter (216×279mm)</option>
            <option value="A3">A3 (297×420mm)</option>
            <option value="A5">A5 (148×210mm)</option>
            <option value="A6">A6 (105×148mm)</option>
            <option value="4x6">4×6" (101.6×152.4mm)</option>
            <option value="Custom">Custom Size</option>
          </select>
          
          <div id="customCanvas">
            <div class="grid-2col">
              <div class="form-group">
                <label for="customWidth">Width (mm):</label>
                <div class="slider-group">
                  <input type="range" id="customWidthSlider" min="10" max="500" value="100" step="1">
                  <input type="number" id="customWidth" value="100" min="10" step="1">
                </div>
              </div>
              <div class="form-group">
                <label for="customHeight">Height (mm):</label>
                <div class="slider-group">
                  <input type="range" id="customHeightSlider" min="10" max="500" value="100" step="1">
                  <input type="number" id="customHeight" value="100" min="10" step="1">
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="markerColor">Marker Color:</label>
          <div class="color-picker" id="pickerMarker">
            <input type="color" id="markerColor" value="#FF0000" class="color-picker-input">
            <div class="color-display" style="background-color: #FF0000;">Marker</div>
          </div>
        </div>
      </div>
      
      <h2>Tile Settings</h2>
      <div class="grid-2col">
        <div>
          <div class="form-group">
            <label for="tileSize">Tile Size (mm):</label>
            <div class="slider-group">
              <input type="range" id="tileSizeSlider" min="5" max="50" value="20" step="1">
              <input type="number" id="tileSize" value="20" min="5" max="50" step="1">
            </div>
          </div>
          
          <div class="form-group">
            <label for="tileMargin">Tile Margin (mm):</label>
            <div class="slider-group">
              <input type="range" id="tileMarginSlider" min="0" max="20" value="5" step="1">
              <input type="number" id="tileMargin" value="5" min="0" max="20" step="1">
            </div>
          </div>
          
          <div class="form-group">
            <label for="linePadding">Line Padding (% of tile):</label>
            <div class="slider-group">
              <input type="range" id="linePaddingSlider" min="1" max="50" value="10" step="1">
              <input type="number" id="linePadding" value="10" min="1" max="50" step="1">
            </div>
          </div>
        </div>
        
        <div>
          <div class="form-group">
            <label for="tileRows">Number of Rows:</label>
            <div class="slider-group">
              <input type="range" id="tileRowsSlider" min="1" max="30" value="10" step="1">
              <input type="number" id="tileRows" value="10" min="1" max="30" step="1">
            </div>
          </div>
          
          <div class="form-group">
            <label for="tileCols">Number of Columns:</label>
            <div class="slider-group">
              <input type="range" id="tileColsSlider" min="1" max="20" value="5" step="1">
              <input type="number" id="tileCols" value="5" min="1" max="20" step="1">
            </div>
          </div>
          
          <div class="form-group">
            <label for="startSeq">Start Sequence Number:</label>
            <div class="slider-group">
              <input type="range" id="startSeqSlider" min="0" max="100" value="1" step="1">
              <input type="number" id="startSeq" value="1" min="0" step="1">
            </div>
          </div>
        </div>
      </div>
      
      <h2>Marker Options</h2>
      <div class="form-group">
        <div class="checkbox-group">
          <input type="checkbox" id="includeNotch" checked>
          <label for="includeNotch">Include Corner Notch</label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="includeLine" checked>
          <label for="includeLine">Include Bottom Line</label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="showText" checked>
          <label for="showText">Show Text Label</label>
        </div>
      </div>
      
      <div class="button-group">
        <button onclick="generateSVG()">Generate Tags</button>
        <button onclick="downloadSVG()" class="button-secondary">Download SVG</button>
      </div>
    </div>
    
    <div class="card">
      <h2>Preview</h2>
      <div id="svgContainer">
        <p>Tags will appear here after generation</p>
      </div>
    </div>
  </div>

  <script>
    // Initialize color pickers and sync with letters
    document.addEventListener('DOMContentLoaded', function() {
      // Function to setup color picker behavior
      function setupColorPicker(colorInputId, displaySelector, letterInputId) {
        const colorInput = document.getElementById(colorInputId);
        const display = document.querySelector(displaySelector);
        const letterInput = document.getElementById(letterInputId);
        
        // Update display when color changes
        colorInput.addEventListener('input', function() {
          display.style.backgroundColor = this.value;
          // Auto-adjust text color based on background brightness
          const rgb = hexToRgb(this.value);
          const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
          display.style.color = brightness > 125 ? '#000000' : '#ffffff';
        });
        
        // Update letter on display when letter input changes
        if (letterInput) {
          letterInput.addEventListener('input', function() {
            display.textContent = this.value || ' ';
          });
        }
      }
      
      // Setup all color pickers
      setupColorPicker('colorTL', '#pickerTL .color-display', 'letterTL');
      setupColorPicker('colorTR', '#pickerTR .color-display', 'letterTR');
      setupColorPicker('colorBL', '#pickerBL .color-display', 'letterBL');
      setupColorPicker('colorBR', '#pickerBR .color-display', 'letterBR');
      setupColorPicker('markerColor', '#pickerMarker .color-display');
      
      // Setup all slider-number pairs
      setupSliderNumberPair('tileSizeSlider', 'tileSize');
      setupSliderNumberPair('tileMarginSlider', 'tileMargin');
      setupSliderNumberPair('linePaddingSlider', 'linePadding');
      setupSliderNumberPair('tileRowsSlider', 'tileRows');
      setupSliderNumberPair('tileColsSlider', 'tileCols');
      setupSliderNumberPair('startSeqSlider', 'startSeq');
      setupSliderNumberPair('customWidthSlider', 'customWidth');
      setupSliderNumberPair('customHeightSlider', 'customHeight');
    });
    
    // Helper function to convert hex to RGB
    function hexToRgb(hex) {
      // Remove the # if present
      hex = hex.replace(/^#/, '');
      
      // Parse the components
      let bigint = parseInt(hex, 16);
      let r = (bigint >> 16) & 255;
      let g = (bigint >> 8) & 255;
      let b = bigint & 255;
      
      return { r, g, b };
    }
    
    // Function to sync slider with number input
    function setupSliderNumberPair(sliderId, numberId) {
      const slider = document.getElementById(sliderId);
      const number = document.getElementById(numberId);
      
      // Update number when slider changes
      slider.addEventListener('input', function() {
        number.value = this.value;
      });
      
      // Update slider when number changes
      number.addEventListener('input', function() {
        slider.value = this.value;
      });
    }

    // Show/hide custom canvas fields
    function toggleCustomCanvas() {
      const canvasSelect = document.getElementById("canvasSize").value;
      document.getElementById("customCanvas").style.display = 
        (canvasSelect === "Custom") ? "block" : "none";
    }

    // Convert an integer to a 4-digit base-4 string
    function toBase4(num) {
      let code = num.toString(4);
      while (code.length < 4) {
        code = "0" + code;
      }
      return code;
    }

    function generateSVG() {
      // Quadrant mappings (top-left, top-right, bottom-left, bottom-right)
      const letterTL = document.getElementById('letterTL').value || 'C';
      const colorTL  = document.getElementById('colorTL').value;
      const letterTR = document.getElementById('letterTR').value || 'M';
      const colorTR  = document.getElementById('colorTR').value;
      const letterBL = document.getElementById('letterBL').value || 'Y';
      const colorBL  = document.getElementById('colorBL').value;
      const letterBR = document.getElementById('letterBR').value || 'K';
      const colorBR  = document.getElementById('colorBR').value;

      // We'll store them in an array, index 0=top-left, 1=top-right, 2=bottom-left, 3=bottom-right
      // This matches the base-4 digit positions we use later.
      const mappings = [
        { letter: letterTL, color: colorTL },
        { letter: letterTR, color: colorTR },
        { letter: letterBL, color: colorBL },
        { letter: letterBR, color: colorBR }
      ];

      // Canvas selection
      let canvasOption = document.getElementById('canvasSize').value;
      let pageWidth, pageHeight;
      switch (canvasOption) {
        case "A4":
          pageWidth = 210; pageHeight = 297; break;
        case "Letter":
          pageWidth = 216; pageHeight = 279; break;
        case "A3":
          pageWidth = 297; pageHeight = 420; break;
        case "A5":
          pageWidth = 148; pageHeight = 210; break;
        case "A6":
          pageWidth = 105; pageHeight = 148; break;
        case "4x6":
          pageWidth = 101.6; pageHeight = 152.4; break;
        case "Custom":
          pageWidth  = parseFloat(document.getElementById('customWidth').value);
          pageHeight = parseFloat(document.getElementById('customHeight').value);
          break;
        default:
          pageWidth = 210; pageHeight = 297;
      }

      // Tile & layout settings
      const tileSize  = parseFloat(document.getElementById('tileSize').value);
      const tileMargin= parseFloat(document.getElementById('tileMargin').value);
      const rows      = parseInt(document.getElementById('tileRows').value);
      const cols      = parseInt(document.getElementById('tileCols').value);
      const linePad   = parseFloat(document.getElementById('linePadding').value);
      const startSeq  = parseInt(document.getElementById('startSeq').value);

      // Marker options
      const includeNotch  = document.getElementById('includeNotch').checked;
      const includeLine   = document.getElementById('includeLine').checked;
      const showText      = document.getElementById('showText').checked;
      const markerColor   = document.getElementById('markerColor').value;

      // Compute horizontal line gap & thickness as a fraction of tileSize
      const gap       = includeLine ? tileSize * (linePad / 100) : 0;
      const thickness = includeLine ? tileSize * (linePad / 100) : 0;

      // Space between the bottom of any marker and the text
      const textGap = tileSize * 0.20;

      // The total vertical space for markers & text below the tile
      const markerSpace = includeLine ? (gap + thickness + textGap) : textGap;

      // Cell dimensions
      const cellWidth  = tileSize + tileMargin;
      const cellHeight = tileSize + markerSpace + tileMargin;

      // Page margin
      const pageMargin = 10;
      const startX = pageMargin;
      const startY = pageMargin;

      // Start building the SVG
      let svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${pageWidth}mm" height="${pageHeight}mm" viewBox="0 0 ${pageWidth} ${pageHeight}">`;
      // Optional dashed border around the page
      svg += `<rect x="0" y="0" width="${pageWidth}" height="${pageHeight}" fill="white" stroke="#ccc" stroke-dasharray="2,2" />`;

      // Generate each tile
      let tileIndex = 0;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          // Position of this tile
          const tileX = startX + c * cellWidth;
          const tileY = startY + r * cellHeight;

          // Convert (startSeq - 1 + tileIndex) to a 4-digit base-4 code
          const baseValue = startSeq - 1 + tileIndex;
          const codeDigits = toBase4(baseValue);

          // Build the 4-letter code (e.g. "CMYK")
          let codeLetters = "";
          for (let d = 0; d < 4; d++) {
            const digit = parseInt(codeDigits[d]);
            codeLetters += mappings[digit].letter;
          }

          // Sequence number
          const overallNumber = startSeq + tileIndex;
          const labelText = codeLetters + " - " + overallNumber;

          // Start a group for the tile
          svg += `<g transform="translate(${tileX},${tileY})">`;

          // 2x2 quadrants
          const half = tileSize / 2;
          // codeDigits[0] => top-left, codeDigits[1] => top-right, etc.
          const digitTL = parseInt(codeDigits[0]);
          const digitTR = parseInt(codeDigits[1]);
          const digitBL = parseInt(codeDigits[2]);
          const digitBR = parseInt(codeDigits[3]);

          svg += `<rect x="0"     y="0"      width="${half}" height="${half}" fill="${mappings[digitTL].color}" />`;
          svg += `<rect x="${half}" y="0"      width="${half}" height="${half}" fill="${mappings[digitTR].color}" />`;
          svg += `<rect x="0"     y="${half}" width="${half}" height="${half}" fill="${mappings[digitBL].color}" />`;
          svg += `<rect x="${half}" y="${half}" width="${half}" height="${half}" fill="${mappings[digitBR].color}" />`;

          // Notch marker (top-left corner)
          if (includeNotch) {
            const notchSize = tileSize / 4;
            svg += `<polygon points="0,0 ${notchSize},0 0,${notchSize}" fill="${markerColor}" />`;
          }

          // Horizontal line marker
          if (includeLine) {
            svg += `<line x1="0" y1="${tileSize + gap}" x2="${tileSize}" y2="${tileSize + gap}" stroke="${markerColor}" stroke-width="${thickness}" />`;
          }

          // Dynamic font size so text doesn't bleed at small tile sizes
          const fontSize = Math.max(3, tileSize * 0.12);

          // Place text below markers
          if (showText) {
            const yText = tileSize + (includeLine ? (gap + thickness) : 0) + textGap + fontSize * 0.8;
            // Slight left offset so text isn't flush against the left
            svg += `<text x="5" y="${yText}" font-size="${fontSize}" fill="#333">${labelText}</text>`;
          }

          svg += `</g>`; // end tile group
          tileIndex++;
        }
      }

      svg += `</svg>`;

      // Show in preview
      document.getElementById('svgContainer').innerHTML = svg;
      window.generatedSVG = svg;
    }

    function downloadSVG() {
      if (!window.generatedSVG) {
        alert("Please generate the SVG first.");
        return;
      }
      const blob = new Blob([window.generatedSVG], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);

      // Create a hidden link, click it, then remove it
      const a = document.createElement('a');
      a.style.display = 'none';
      a.href = url;
      a.download = 'unique_tags.svg';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>